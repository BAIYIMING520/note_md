- [系统原理](#%e7%b3%bb%e7%bb%9f%e5%8e%9f%e7%90%86)
  - [ACID 的作用以及实现原理](#acid-%e7%9a%84%e4%bd%9c%e7%94%a8%e4%bb%a5%e5%8f%8a%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86)
  - [四大隔离级别，以及不可重复读和幻影读的出现原因](#%e5%9b%9b%e5%a4%a7%e9%9a%94%e7%a6%bb%e7%ba%a7%e5%88%ab%e4%bb%a5%e5%8f%8a%e4%b8%8d%e5%8f%af%e9%87%8d%e5%a4%8d%e8%af%bb%e5%92%8c%e5%b9%bb%e5%bd%b1%e8%af%bb%e7%9a%84%e5%87%ba%e7%8e%b0%e5%8e%9f%e5%9b%a0)
  - [乐观锁与悲观锁](#%e4%b9%90%e8%a7%82%e9%94%81%e4%b8%8e%e6%82%b2%e8%a7%82%e9%94%81)
  - [MVCC 原理，当前读以及快照读，Next-Key Locks解决幻影读](#mvcc-%e5%8e%9f%e7%90%86%e5%bd%93%e5%89%8d%e8%af%bb%e4%bb%a5%e5%8f%8a%e5%bf%ab%e7%85%a7%e8%af%bbnext-key-locks%e8%a7%a3%e5%86%b3%e5%b9%bb%e5%bd%b1%e8%af%bb)
  - [SQL 与 NoSQL 的比较](#sql-%e4%b8%8e-nosql-%e7%9a%84%e6%af%94%e8%be%83)
- [mySQL](#mysql)
  - [B+ Tree 原理，与其它查找树的比较](#b-tree-%e5%8e%9f%e7%90%86%e4%b8%8e%e5%85%b6%e5%ae%83%e6%9f%a5%e6%89%be%e6%a0%91%e7%9a%84%e6%af%94%e8%be%83)
  - [MySQL 索引以及优化](#mysql-%e7%b4%a2%e5%bc%95%e4%bb%a5%e5%8f%8a%e4%bc%98%e5%8c%96)
  - [查询优化](#%e6%9f%a5%e8%af%a2%e4%bc%98%e5%8c%96)
  - [InnoDB 与 MyISAM 比较](#innodb-%e4%b8%8e-myisam-%e6%af%94%e8%be%83)
- [Redis](#redis)
  - [使用场景](#%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af)
  - [与 Memchached 的比较](#%e4%b8%8e-memchached-%e7%9a%84%e6%af%94%e8%be%83)
  - [集群与分布式](#%e9%9b%86%e7%be%a4%e4%b8%8e%e5%88%86%e5%b8%83%e5%bc%8f)
  - [线程安全问题](#%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e9%97%ae%e9%a2%98)
  - [字典和跳跃表原理分析](#%e5%ad%97%e5%85%b8%e5%92%8c%e8%b7%b3%e8%b7%83%e8%a1%a8%e5%8e%9f%e7%90%86%e5%88%86%e6%9e%90)
  - [RDB 和 AOF 持久化机制](#rdb-%e5%92%8c-aof-%e6%8c%81%e4%b9%85%e5%8c%96%e6%9c%ba%e5%88%b6)
  - [事务原理](#%e4%ba%8b%e5%8a%a1%e5%8e%9f%e7%90%86)


# 系统原理

## ACID 的作用以及实现原理
ACID是数据库为保障数据安全而需要的四个特性.
- A原子性: 一个事务要么完全做完, 要么完全不做, 不存在中间状态, 在完成前对外不可见. 通过事务模型,提交或回滚.
- C一致性: 数据库总是从一个一致性状态转移到另一个一致性状态, 所谓一致性状态指的是每个原子操作都是完整的
- I隔离性: 并发的事务之间不会感知彼此的存在, 不会受到彼此影响, mySQL有4个隔离级别. 通过锁机制和MVCC
- D持久性: 一旦数据写入, 即使数据库崩溃等情况发生, 数据也能够被恢复和持久化的保存. 日志.

原子性和隔离性是保障一致性的前提, 持久性则是数据安全的前提.


## 四大隔离级别，以及不可重复读和幻影读的出现原因
- 四大隔离级别
  - 非提交读(uncommit Read): 未提交的事务中对数据的修改对外可见. 数据库中很少使用这个隔离级别, 会产生脏读.
  - 提交读(commited Read): 正在进行的事务能够读到其他已提交事务的结果. Oracle数据库的运行级别, 存在问题是不可重复读.
  - 可重复读(Repeated Read): 正在进行的事务读到的数据总是保持一致. mySQL的运行级别. 在这个级别可能存在的问题, 幻读
  - 序列化执行(Serialized Read): 所有事务按照序列顺序执行, 最高的隔离级别, 不具有并发性

- 不同隔离级别出现的问题:
  - 脏读: 读到其他事务的未提交数据. A事务读到B事务的未提交修改, 而B事务发生了回滚, 此时A事务读的数据就是脏数据
  - 不可重复读: 由于能够读到其他已提交事务的更新, 造成正在执行的事务前后两次读到的数据不同. 例如事务A第一次读到id=1的数据为x, 此时B事务对id=1进行修改为y, 并提交; 在A事务中再次读时读到的是y, 前后不一致所以称为不可重复读. [不可重复读强调的是update, delete的影响]
  - 幻读: 在A事务进行中前后两次的范围查询结果不一致. 例如A事务第一次`select * from table where id between 1 and 5;`后, 事务B插入了一条`id=4`的数据并提交, 在A事务中再次查询时得到的结果比第一次多了一条, 成为幻读. [幻读强调的是insert的影响] 在上述场景下, 即使在可重复读隔离级别下, 第一次查询的数据行都没有发生变化,但是仍然会无故多出一条.

## 乐观锁与悲观锁

## MVCC 原理，当前读以及快照读，Next-Key Locks解决幻影读
MVCC原理:
- 在数据行最后添加两列, trx_id和roll_ptr, trx_id标识了当前行的版本, roll_ptr是一个指向该记录之前版本的数据行的指针. 同时事务开始时维护了一个read_view的数据结构, 包括了当前没有提交的事务的id, 以及最小id和最大id. 在RR级别, `select`读数据会读trx_id小于min_trx_id的最后一条数据, 这是**快照读**, 而`update`, `delete`语句会通过加锁读的方式读最新的被提交的数据, 这是**当前读**.

Next-key locks解决幻读:
- MVCC+Next-key lock可以解决RR级别的幻读问题, 在锁行的时候通过gap锁将当前行到上一个索引和下一个索引的间隙一并锁上, 防止插入.
## SQL 与 NoSQL 的比较

# mySQL

## B+ Tree 原理，与其它查找树的比较
n路B+树的非叶子节点维护
## MySQL 索引以及优化

## 查询优化

## InnoDB 与 MyISAM 比较
- InnoDB支持事务，MyISAM不支持，这一点是非常之重要。事务是一种高级的处理方式，如在一些列增删改中只要哪个出错还可以回滚还原，而MyISAM就不可以了。
- MyISAM适合查询以及插入为主的应用，InnoDB适合频繁修改以及涉及到安全性较高的应用
- InnoDB支持外键，MyISAM不支持
- InnoDB不支持FULLTEXT类型的索引
- InnoDB中不保存表的行数，如select count(*) from table时，InnoDB需要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可。注意的是，当count(*)语句包含where条件时MyISAM也需要扫描整个表
- 对于自增长的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中可以和其他字段一起建立联合索引
- 清空整个表时，InnoDB是一行一行的删除，效率非常慢。MyISAM则会重建表
- InnoDB支持行锁（某些情况下还是锁整表，如 update table set a=1 where user like '%lee%'

# Redis
redis的常用数据类型: 字符串, list, hash表, set, zset(有序集合)

## 使用场景


## 与 Memchached 的比较

## 集群与分布式

## 线程安全问题

## 字典和跳跃表原理分析

## RDB 和 AOF 持久化机制
RDB是将当前的内存中数据快照存储到磁盘, 可以在配置文件中设置 save sec num 当sec秒内有num个修改时就进行一次存储, 存储的是二进制的内容

AOF是增量记录非查询操作, 构成一个日志, 可以设置写磁盘的频率.

混合持久化, 这种持久化能够通过AOF重写操作创建出一个同时包含RDB数据和AOF数据的AOF文件， 其中RDB数据位于AOF文件的开头， 它们储存了服务器开始执行重写操作时的数据库状态： 至于那些在重写操作执行之后执行的Redis命令， 则会继续以AOF格式追加到AOF文件的末尾， 也即是RDB数据之后。

## 事务原理