- [第一章 操作系统概述](#%e7%ac%ac%e4%b8%80%e7%ab%a0-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e6%a6%82%e8%bf%b0)
	- [基本构成](#%e5%9f%ba%e6%9c%ac%e6%9e%84%e6%88%90)
	- [存储器的层次结构](#%e5%ad%98%e5%82%a8%e5%99%a8%e7%9a%84%e5%b1%82%e6%ac%a1%e7%bb%93%e6%9e%84)
- [第2章 操作系统概述](#%e7%ac%ac2%e7%ab%a0-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e6%a6%82%e8%bf%b0)
	- [1.  操作系统的目标与功能](#1-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e7%9a%84%e7%9b%ae%e6%a0%87%e4%b8%8e%e5%8a%9f%e8%83%bd)
	- [2. 操作系统的发展](#2-%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%8f%91%e5%b1%95)
	- [3. 主要成就](#3-%e4%b8%bb%e8%a6%81%e6%88%90%e5%b0%b1)
	- [4. 现代操作系统](#4-%e7%8e%b0%e4%bb%a3%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f)
- [第3章 进程描述与控制](#%e7%ac%ac3%e7%ab%a0-%e8%bf%9b%e7%a8%8b%e6%8f%8f%e8%bf%b0%e4%b8%8e%e6%8e%a7%e5%88%b6)
	- [1. 进程的概念](#1-%e8%bf%9b%e7%a8%8b%e7%9a%84%e6%a6%82%e5%bf%b5)
	- [2. 进程的状态](#2-%e8%bf%9b%e7%a8%8b%e7%9a%84%e7%8a%b6%e6%80%81)
	- [3. 进程的描述](#3-%e8%bf%9b%e7%a8%8b%e7%9a%84%e6%8f%8f%e8%bf%b0)
	- [4. 进程的控制](#4-%e8%bf%9b%e7%a8%8b%e7%9a%84%e6%8e%a7%e5%88%b6)
	- [5. 计算机的执行](#5-%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%9a%84%e6%89%a7%e8%a1%8c)
- [第四章 线程](#%e7%ac%ac%e5%9b%9b%e7%ab%a0-%e7%ba%bf%e7%a8%8b)


# 第一章 操作系统概述

## 基本构成
**1.计算机组成**
处理器 内存 I/O设备 系统总线
寄存器类型：存储器地址寄存器：用于确定下一次读写的存储器地址 存储器缓存寄存器：用于存放要写入存储器的数据或从存储器读取的数据
**2.  指令的类型**
处理器与存储器，处理器与外部设备，控制， 数据处理
指令周期：一个指令周期包括取指阶段和执行阶段，有中断的情况下还有中断情况检查阶段
**3. 中断**
处理器在执行程序时，遇到意外的外部情况时，能够自动的停止当前的程序，转入意外情况的处理程序，在处理后能够自动转回到当前正在执行的程序的功能。
中断类型

![mark](http://cdn.hustcaid.com/pictures/20190130/nAUc8PU3l0SR.jpg?imageslim)

中断处理的两种策略：在处理中断时禁止处理新的中断；根据中断的优先级决定处理的中断。
存在中断时的控制流

![中断流程](http://cdn.hustcaid.com/pictures/20190130/OTm9jIaxB5aY.jpg?imageslim)

## 存储器的层次结构
存储器层次：板上存储器，板外存储器，离线存储器
- 容量依次增加，速度依次减慢，原理：低层次访问频率递减——时间局部性和空间局部性
- 时间局部性： 存储器上被访问一次的位置在近期可能被再次访问
- 空间局部性：存储器上被访问的位置的附近在近期可能被访问
- I/O操作的三种方式：可编程I/O， 中断I/O，DMA
  - 可编程I/O：线性使用处理器，在进行I/O时等待
  - 中断I/O：并行的执行I/O通过中断，开始和结束处理
  - DMA：独立模块，读写完成时提出中断

多处理器和多核处理器
- 多处理器：处理器之间相互独立，有自己的寄存器和缓存，当一个失效时其他继续工作，具有伸缩性
- 多核处理器：多个处理器组装在同一个硅片上，有独立的一二级缓存，共享三级缓存

# 第2章 操作系统概述

## 1.  操作系统的目标与功能
操作系统的目标：
- 有效
- 方便
- 拓展能力
操作系统的典型接口：
- 指令系统体系结构（ISA）
- 应用程序二进制接口（ABI）
- 应用程序编程接口（API）
内核：内核程序包含操作系统中最常使用的功能： 进程管理，中断异常处理，同步等
## 2. 操作系统的发展
- 串行处理
- 批处理系统
    监控程序作为一个计算机程序，依赖处理器可以从内存不同部分取址的能力，交替释放和获取控制权
    批处理系统中的监控程序已经具有了内存保护、特权指令、定时器、中断功能。处理器的运行分为用户态和内核态两种状态。只有在内核态下，处理器才可以执行特权指令和访问受保护的内存地址。
- 多道批处理系统
    多道程序设计，将多个程序加载到内存，在不同的程序之间进行切换，提高处理器的使用效率。
    多道批处理系统的重要辅助功能：I/O中断和DMA， 同时开始具有内存调度和内存管理算法
- 分时系统
分时系统和批处理系统的不同
## 3. 主要成就
**进程**

进程的组成
- 一段可执行程序
- 程序需要的相关数据（变量、工作空间、缓存）
- 执行上下文
    - 执行上下文：是操作系统管理和控制进程所需的内部数据，包括各种处理器寄存器的内容，如程序计数器和数据寄存器；操作系统使用的信息，如优先级和是否等待资源。

线程：一个被分配资源的进程可以分解为多个并发的线程，相互协作执行完成任务。

**内存管理**

基本的存储器管理职责：
- 进程隔离
- 内存的自动分配和回收
- 长期储存
- 支持模块化程序设计
- 保护和访问机制

虚地址：由页号和页偏移组成的分页系统中的内存地址。 实地址： 内容的物理地址。

**调度与资源管理的要求**
- 公平性
- 有差别的响应性
- 高效性

## 4. 现代操作系统
单体内核/微内核： 单体内核集成了文件管理、存储管理、设备管理等较多功能，通过一个进程执行，共享地址空间。微内核只给内核分配一些基本的功能，包括地址空间，进程间通信和基本的调度。剩下的系统服务以一般的用户态进程的形式提供。
多核处理的设计考虑因素
- 并发进程或线程
- 调度
- 同步
- 内存管理
- 可靠性和兼容性

# 第3章 进程描述与控制

## 1. 进程的概念

进程的定义:
- 一个正在执行的程序
- 一个正在计算机上执行的程序实例
- 能够分配给处理器并由处理器执行的实体
- 一个具有以下特征的活动单元: 一组指令序列的执行, 一个当前状态, 一个系统资源集

**进程控制块**是使系统支持多重处理技术的关键工具.当进程中断时, 操作系统会把程序计数器和处理器寄存器(上下文数据)写入到进程控制块的相应位置, 进程控制块中包含足够充分的信息, 保证在中断后恢复现场时能够像从来没有中断过一样.

## 2. 进程的状态


进程的创建的四种原因
![](http://cdn.hustcaid.com/FulRePF73uIANSynkKHBQ5Qw675k.jpg)

进程终止的原因
![](http://cdn.hustcaid.com/Fg8S2V4yRW9rGrB0s5IL15SKztl4.jpg)

**抢占** 当优先级更高的进程出现在就绪态, 操作系统中断当前进程的执行,将处理器分派给优先级更高的进程的现象.

为什么需要多个阻塞队列?
- 一个事件对应一个队列,减少事件发生时的检索开销.

七状态模型
- 新建态: 刚刚创建的进程, 通常进程控制块已经创建, 但还没有加载到内存中的新进程
- 就绪态: 进程做好准备只要有机会就可以运行
- 运行态: 进程占用处理器, 正在执行
- 退出态: 操作系统从执行进程组中释放的进程, 因自身停止或因某种原因被取消
- 阻塞态: 进程在内存中, 在某些事件发生前不能执行
- 挂起/阻塞态: 进程被交换到外存中等待某一事件的发生
- 挂起/就绪态: 进程被交换到外存中, 等待操作系统将其转移到内存上并可以执行

![七状态转换模型](http://cdn.hustcaid.com/FnqCWMbthY7E9aEVi2yALceQHqJy.jpg)

新建态的两步:
- 将标识符关联到进程, 分配和创建进程所需要的所有表[创建pcb]
- 进程处于新建态时, 操作系统所需要的关于该进程的信息保存在内存的进程表中, 但进程尚未进入内存,即执行的程序代码不在内存中, 也没有为这个程序的相关数据分配空间.[代码数据没有在内存中分配空间]

退出态的两步:
- 进程到达自然结束点或出现不可恢复的错误而取消时, 进程被终止, 转入退出态
- 辅助程序或支持程序提取必要的分析信息,供分析性能和利用率

**交换** 把内存的某个进程一部分或全部移到磁盘中
> 交换是一个I/O操作, 可能使问题更加恶化. 虚拟内存的使用看上去消除了显式交换的需求, 因为通过处理器中的储存管理硬件, 任何期望的进程中的任何期望的地址都可以移入或移出内存. 即使在虚拟存储系统中, 操作系统也需要不时的更具执行情况, 显式的,完全的换出进程.

挂起的特点:
- 进程不能被立刻执行
- 挂起条件和阻塞条件独立, 进程可能在也可能不在等待一个事件
- 为阻止这个进程的执行, 可以通过代理把这个进程置于挂起状态, 代理可以是自己, 父进程或操作系统.
- 除非代理显式的要求系统进行状态转换, 否则进程无法从这个状态转移.

## 3. 进程的描述

问题: 操作系统为了控制进程和管理资源需要哪些信息?
- 为内存, 设备, 文件和进程维护四个实体信息表;
- 四个表之间有存在交叉引用, 例如I/O设备可能打开某些文件

进程映像的成员: 用户程序 用户数据 栈 进程控制块

![映像在虚存中的结构](http://cdn.hustcaid.com/FpaOLuDZDxD4euLczOmhmMQTwk1I.jpg)

PCB包含的信息
- 标识信息 包括进程ID 父进程ID 用户标识符
- 状态信息 寄存器信息(用户可见的寄存器, 程序状态寄存器) 栈指针
- 控制信息 调度信息, 用于放到进程链表的数据结构 资源所有权和使用情况 进程间通信 进程特权 存储管理(指向虚存的段表和页表的指针)

## 4. 进程的控制
模式切换: 处理中断时首先要从用户模式切换到内核模式, 这个切换只需要保存当前进程的寄存器和栈信息

进程切换: 发生在操作系统从当前进程获得控制权的时刻(包括中断, 陷阱, 系统调用); 进程切换会首先保存处理器上下文, 更新进程控制块状态, 吧进程控制块移到相应的链表, 选择另一个进程, 更新所选进程控制块, 更新内存管理数据结构 

进程切换一定包含模式切换, 模式切换后有可能维持原来的进程继续

中断和陷阱的比较: 两者都是系统中断, 前者是由于发生与当前进程无关的外部事件产生, 如一次I/O完成等;后者是由于进程自身产生错误或异常, 如非法的文件访问. 
- 普通中断包括例如: 时钟中断, I/O中断, 内存失效中断等. 
- 此外还有一种引起进程切换的原因是系统调用, 是进程的显示请求调用操作系统函数,使用系统调用时会将用户进程设为阻塞态

模式切换和进程切换的比较: 进程切换一定包含模式切换, 但模式切换到内核模式后仍可能返回继续执行原进程, 也可能调度其他进程.模式切换只需要保存寄存器和栈信息, 而进程切换则需要做更多工作.

## 5. 计算机的执行
![内核模型](http://cdn.hustcaid.com/Fqg6F2rGqhsYxKjCU1SYLu9124mm.jpg)

三种内核模型

- 无进程内核: 独立于进程之外运行的内核; 进程概念只适用于用户进程, 操作系统代码是在特权模式下运行的独立实体
- 在用户进程内运行: 每个用户进程都包含一个用户栈和内核栈, 和一个共享地址空间, 操作系统代码位于共享地址空间, 当用户进程切换到特权模式时不用切换进程,在本进程内利用内核栈就可以完成操作系统需要运行的代码;在一个进程中, 用户程序和操作系统程序都可以执行, 而不同用户进程中执行的操作系统程序是相同的.
- 基于进程的操作系统: 内核功能被组织成一组独立的进程, 任何进程外还存在一部分切换代码. 模块化, 提高性能.

在Unix中, 系统启动时, 首先会启动0号进程, 是进程切换器, 0号进程派生出1号进程, 是所有进程的根进程, 当一个用户进程处于僵死状态后, 由父进程完成最后处理工作, 但是如果这时父进程已经退出, root进程会定期清理僵尸进程.

Unix属于第二种, 在用户进程内运行, 状态转化模型中增加了僵死状态, 将运行态拆成内核运行态和用户运行态两个部分.

僵死状态下, 进程已经不再存在, 但它留下了一条其父进程可以收集的记录(fork创建子进程, 在wait函数中处理子进程的僵死状态, 为子进程收尾)


# 第四章 线程

进程与线程的区别与联系:
- 进程是资源管理与分配的基本单位, 负责管理文件, 设备, 内存等资源的管理
- 线程是程序执行的最小单位, 包括了线程上下文, 执行栈, 局部变量的存储空间, 同一进程中的线程共享内存和资源